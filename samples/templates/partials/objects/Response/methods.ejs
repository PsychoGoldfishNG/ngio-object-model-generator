    <%# EJS DOCUMENTATION: https://ejs.co/ %>
    COMMENT: ====================================================================================
    COMMENT: CUSTOM METHODS FOR Response OBJECT - Mixed Type Support and Auto-Update
    COMMENT: ====================================================================================
    
    COMMENT: ====================================================================================
    COMMENT: MIXED TYPE HANDLING FOR result PROPERTY
    COMMENT: ====================================================================================
    
    COMMENT: Sets a single result and clears the list.
    METHOD setResult(resultObject: BaseResult)
        
        PURPOSE: Sets a single BaseResult instance
        
        PARAMETERS:
            resultObject: A single result model instance
        
        BEHAVIOR:
            SET this.result TO resultObject
            SET this.resultList TO null
    END METHOD
    
    COMMENT: Sets an array of results and clears the single value.
    METHOD setResultList(resultArray: Array<BaseResult>)
        
        PURPOSE: Sets an array of BaseResult instances
        
        PARAMETERS:
            resultArray: An array of result model instances (empty clears the list)
        
        BEHAVIOR:
            IF resultArray is not null AND resultArray is not empty THEN
                SET this.resultList TO resultArray
            ELSE
                SET this.resultList TO null
            END IF
            SET this.result TO null
    END METHOD
    
    COMMENT: Checks if using list format.
    METHOD resultIsList(): Boolean
        
        PURPOSE: Determines if this response contains multiple results
        
        RETURNS: True if using list format, false if using single value
        
        BEHAVIOR:
            RETURN this.resultList is an array
    END METHOD
    
    COMMENT: Gets the single result.
    METHOD getResult(): BaseResult
        
        PURPOSE: Returns the single result instance
        
        RETURNS: The single BaseResult instance or null
        
        BEHAVIOR:
            RETURN this.result
    END METHOD
    
    COMMENT: Gets the result array.
    METHOD getResultList(): Array<BaseResult>
        
        PURPOSE: Returns the result array
        
        RETURNS: The array of BaseResult instances or null
        
        BEHAVIOR:
            RETURN this.resultList
    END METHOD
    
    COMMENT: ====================================================================================
    COMMENT: CUSTOM toObject() OVERRIDE
    COMMENT: ====================================================================================
    
    COMMENT: Ensures result uses the active format.
    METHOD toObject(recursive: Boolean, excludeNulls: Boolean): Object
        
        PURPOSE: Serializes Response with correct result format
        
        RETURNS: Plain object ready for JSON encoding
        
        BEHAVIOR:
            CREATE jsonObject AS parent.toObject(recursive, excludeNulls)
            
            IF this.resultList is an array THEN
                SET jsonObject['result'] TO this.resultList
            ELSE IF this.result is not null THEN
                SET jsonObject['result'] TO this.result
            ELSE IF excludeNulls is false THEN
                SET jsonObject['result'] TO null
            ELSE
                REMOVE jsonObject['result']
            END IF
            
            RETURN jsonObject
    END METHOD
    
    COMMENT: ====================================================================================
    COMMENT: CUSTOM importFromObject() OVERRIDE
    COMMENT: ====================================================================================
    
    COMMENT: Instantiates proper result models and updates app state automatically.
    METHOD importFromObject(data: Object)
        
        PURPOSE: Parses response data, creates result model instances, and updates AppState
        
        PARAMETERS:
            data: Plain object containing response data from server
        
        WHY: Automatically converts plain result objects to typed model instances
             and keeps local cached data synchronized with server responses
        
        BEHAVIOR:
            CREATE typedResults AS null
            CREATE responseError AS null
            
            COMMENT: Check if there's an error at the response level
            IF data has property "error" THEN
                SET responseError TO data.error
            END IF
            
            CREATE hasResultProperty AS data has property "result"
            IF hasResultProperty AND data.result is not null THEN
                CREATE rawResults AS data.result
                
                IF rawResults is an array THEN
                    CREATE resultList AS empty array
                    FOR EACH rawResult IN rawResults
                        IF rawResult has property "component" AND rawResult has property "data" THEN
                            CREATE componentName AS rawResult.component
                            CREATE resultData AS rawResult.data
                            CREATE typedResult AS ObjectFactory.CreateResult(
                                componentName split by "." part 0,
                                componentName split by "." part 1,
                                resultData,
                                this.core
                            )
                            IF typedResult is not null THEN
                                IF responseError is not null AND typedResult.error is null THEN
                                    SET typedResult.error TO responseError
                                END IF
                                ADD typedResult TO resultList
                            END IF
                        END IF
                    END FOR
                    IF resultList is not empty THEN
                        SET typedResults TO resultList
                    END IF
                ELSE
                    IF rawResults has property "component" AND rawResults has property "data" THEN
                        CREATE componentName AS rawResults.component
                        CREATE resultData AS rawResults.data
                        SET typedResults TO ObjectFactory.CreateResult(
                            componentName split by "." part 0,
                            componentName split by "." part 1,
                            resultData,
                            this.core
                        )
                        IF typedResults is not null AND responseError is not null AND typedResults.error is null THEN
                            SET typedResults.error TO responseError
                        END IF
                    END IF
                END IF
                
                CREATE modifiedData AS copy of data
                REMOVE modifiedData['result']
                SET data TO modifiedData
            ELSE IF hasResultProperty THEN
                CREATE modifiedData AS copy of data
                REMOVE modifiedData['result']
                SET data TO modifiedData
            END IF
            
            COMMENT: Call parent to handle standard properties (excluding result)
            CALL parent.importFromObject WITH data
            
            COMMENT: Now set the typed results
            IF typedResults is not null THEN
                IF typedResults is an array THEN
                    CALL this.setResultList WITH typedResults
                ELSE
                    CALL this.setResult WITH typedResults
                END IF
            ELSE IF hasResultProperty THEN
                CALL this.setResult WITH null
            END IF
            
            COMMENT: Update AppState if available
            IF this.core exists AND this.core.appState exists THEN
                IF this.resultIsList() THEN
                    FOR EACH resultModel IN this.getResultList()
                        CALL this.core.appState.setValueFromResult WITH resultModel
                    END FOR
                ELSE IF this.getResult() is not null THEN
                    CALL this.core.appState.setValueFromResult WITH this.getResult()
                END IF
            END IF
    END METHOD
