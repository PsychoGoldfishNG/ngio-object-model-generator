    <%# EJS DOCUMENTATION: https://ejs.co/ %>
    COMMENT: ====================================================================================
    COMMENT: CUSTOM METHODS FOR SaveSlot OBJECT
    COMMENT: ====================================================================================
    
    COMMENT: Checks if this save slot contains any data.
    METHOD hasData(): Boolean
        
        PURPOSE: Determines if this save slot has been used to store data
        
        RETURNS: True if data exists, false if slot is empty
        
        WHY: Before loading data, you may want to check if the slot has data
        
        BEHAVIOR:
            RETURN this.url is not null
    END METHOD
    
    COMMENT: Clears all data from this save slot.
    METHOD clear(callback: Function, thisArg: Object)
        
        PURPOSE: Deletes the data stored in this save slot
        
        PARAMETERS:
            callback: Function to call when clearing is complete
            thisArg: Context to use when calling the callback
        
        WHY: Users may want to delete their save data or start over
        
        BEHAVIOR:
            COMMENT: Call CloudSave.clearSlot via the core wrapper
            IF this.core is not null THEN
                CALL this.core.callComponent("CloudSave.clearSlot", { id: this.id }, callback, thisArg)
            END IF
    END METHOD

    COMMENT: Loads the raw string data from this save slot.
    METHOD loadRaw(callback: Function, thisArg: Object)
        
        PURPOSE: Retrieves the unprocessed data string from the cloud save slot
        
        PARAMETERS:
            callback: Function to call with the raw data string
            thisArg: Context to use when calling the callback
        
        WHY: Sometimes you want the raw data without JSON parsing
        
        BEHAVIOR:
            COMMENT: Call CloudSave.loadSlot via the core wrapper
            IF this.core is not null THEN
                CALL this.core.callComponent("CloudSave.loadSlot", { id: this.id }, callback, thisArg)
            END IF
    END METHOD
    
    COMMENT: Loads the raw string data from the URL stored on this save slot.
    METHOD loadDataRaw(callback: Function, thisArg: Object)
        
        PURPOSE: Retrieves unprocessed data from the cloud storage URL linked to this save slot
        
        PARAMETERS:
            callback: (required) Function to call with the raw data string (or null if load fails)
            thisArg: Context to use when calling the callback
        
        WHY: Some apps store large save files on external cloud URLs instead of inline
        
        IMPORTANT NOTE: The Newgrounds API v3 may not include the protocol (https://) in the URL.
        If the URL is missing the protocol, prepend "https:" to prevent load errors.
        Prepare for both cases - some URLs may already have the protocol.
        
        BEHAVIOR:
            COMMENT: Check if URL exists and is not empty
            IF this.url is null OR this.url is empty THEN
                COMMENT: No URL stored - call callback with null
                CALL callback WITH context thisArg
                    PASSING null
                RETURN
            END IF
            
            COMMENT: Prepare the URL for loading
            SET loadUrl TO this.url
            
            COMMENT: Add protocol if missing (URL may be missing "https:" prefix)
            IF loadUrl does not contain "://" THEN
                SET loadUrl TO "https:" + loadUrl
            END IF
            
            COMMENT: Load the data from the URL (implementation-specific)
            COMMENT: See IMPLEMENTATION-GUIDE.txt for platform-specific URL loading patterns
            TRY
                CALL LOAD_URL_ASYNC(loadUrl, FUNCTION onLoadComplete(data: String)
                    CALL callback WITH context thisArg
                        PASSING data
                END FUNCTION, FUNCTION onLoadError(error)
                    COMMENT: Load failed - log the error and return null gracefully
                    LOG_ERROR("Failed to load SaveSlot data from URL: " + error.message)
                    CALL callback WITH context thisArg
                        PASSING null
                END FUNCTION)
            CATCH loadError
                COMMENT: URL loading setup failed
                LOG_ERROR("Failed to load SaveSlot data from URL: " + loadError.message)
                CALL callback WITH context thisArg
                    PASSING null
            END TRY
    END METHOD
    
    COMMENT: Loads data from the URL stored on this save slot and parses it as JSON.
    METHOD loadData(callback: Function, thisArg: Object)
        
        PURPOSE: Retrieves and decodes JSON data from the cloud storage URL linked to this save slot
        
        PARAMETERS:
            callback: (required) Function to call with the decoded object (or null if load/parse fails)
            thisArg: Context to use when calling the callback
        
        WHY: Combines URL loading and JSON parsing for external cloud-stored data
        
        BEHAVIOR:
            COMMENT: Load the raw data from URL first
            CALL this.loadDataRaw WITH callback function
                SET decoded TO null
                
                COMMENT: If data was loaded successfully, decode it from JSON
                IF data is not null THEN
                    TRY
                        SET decoded TO JSON_DECODE(data)
                    CATCH parseError
                        COMMENT: JSON parsing failed
                        LOG_ERROR("Failed to decode SaveSlot data JSON: " + parseError.message)
                        SET decoded TO null
                    END TRY
                END IF
                
                COMMENT: Return the decoded data to the user's callback
                CALL callback WITH context thisArg
                    PASSING decoded
            END callback function, WITH context this
    END METHOD
    
    COMMENT: Saves raw string data to this save slot.
    METHOD setDataRaw(data: String, callback: Function, thisArg: Object)
        
        PURPOSE: Stores raw string data in this cloud save slot
        
        PARAMETERS:
            data: The raw string data to save
            callback: Function to call when saving is complete
            thisArg: Context to use when calling the callback
        
        WHY: Allows saving pre-formatted data without JSON encoding
        
        BEHAVIOR:
            COMMENT: Call CloudSave.setData via the core wrapper
            IF this.core is not null THEN
                CALL this.core.callComponent("CloudSave.setData", { id: this.id, data: data }, callback, thisArg)
            END IF
    END METHOD

    COMMENT: Loads data from this save slot and parses it as JSON.
    METHOD load(callback: Function, thisArg: Object)
        
        PURPOSE: Retrieves and decodes the JSON data from this save slot
        
        PARAMETERS:
            callback: Function to call with the decoded object
            thisArg: Context to use when calling the callback
        
        WHY: Most save data is stored as JSON, this combines loading and parsing
        
        BEHAVIOR:
            COMMENT: Load the raw data first
            CALL this.loadRaw WITH callback function
                SET decoded TO null
                
                COMMENT: If data exists, decode it from JSON
                IF data exists THEN
                    SET decoded TO JSON_DECODE(data)
                END IF
                
                COMMENT: Return the decoded data to the user's callback
                IF callback is not null THEN
                    CALL callback WITH context thisArg
                        PASSING decoded
                END IF
            END callback function, WITH context this
    END METHOD

    COMMENT: Encodes data as JSON and saves it to this save slot.
    METHOD setData(data: Object, callback: Function, thisArg: Object)
        
        PURPOSE: Encodes an object as JSON and saves it to the cloud
        
        PARAMETERS:
            data: The object to encode and save
            callback: Function to call when saving is complete
            thisArg: Context to use when calling the callback
        
        WHY: Simplifies saving - handles JSON encoding automatically
        
        BEHAVIOR:
            CREATE jsonString AS JSON_ENCODE(data)
            CALL this.setDataRaw WITH jsonString, callback, thisArg
    END METHOD
    
    COMMENT: ====================================================================================
    COMMENT: SESSION MANAGEMENT METHOD
    COMMENT: ====================================================================================
    
    COMMENT: Clears session-specific data to return the save slot to its unauthenticated state.
    METHOD clearSessionData()
        
        PURPOSE: Resets user-specific save slot data while keeping the slot structure intact
        
        WHY: Called by AppState.onSessionCleared() when the user's session expires or is cleared
        
        BEHAVIOR:
            SET this.datetime TO null
            SET this.timestamp TO 0
            SET this.size TO 0
            SET this.url TO null
    END METHOD
