<%
/**
 * ====================================================================================
 * TEMPLATE: Object Model
 * ====================================================================================
 * 
 * PURPOSE: Generates class files for core Newgrounds.io object models.
 * 
 * WHAT ARE OBJECTS?: Objects represent data structures returned by the API, such as:
 * - Medal: Represents an achievement/trophy
 * - User: Represents a Newgrounds user
 * - Score: Represents a scoreboard entry
 * - SaveSlot: Represents a cloud save slot
 * 
 * AVAILABLE VARIABLES:
 * - model: Object containing all properties and metadata for this object
 * - model.name: The name of the object (e.g., "Medal", "User")
 * - model.description: Human-readable description of what this object represents
 * - model.properties: Object containing all properties this object has
 * - helpers: Your custom helper methods (from helpers.js)
 * - partial: Methods to include partial templates (partial.get, partial.getIfExists)
 * - config: Your full config object with all settings
 * 
 * EJS DOCUMENTATION: https://ejs.co/
 * 
 * ====================================================================================
 */

// COMMENT: Prepare data structures we'll need while generating this class
// NOTE: Filter out 'error' because it's inherited from BaseObject
const propertyNames = Object.keys(model.properties).filter(prop => prop !== 'error');
const requiredParams = [];
const hasProperties = propertyNames.length > 0;
%>

COMMENT: ====================================================================================
COMMENT: IMPORTS / DEPENDENCIES
COMMENT: ====================================================================================
<%# Include any imports needed for this object type. -%>
<%# Use partials to add object-specific imports. Example partial path for Medal object: -%>
<%# {partials_dir}/objects/Medal/imports.ejs -%>
<%- partial.getIfExists(`objects/${model.name}/imports`) -%>

COMMENT: ====================================================================================
COMMENT: CLASS DEFINITION
COMMENT: ====================================================================================
<%- helpers.formatMultilineComment(model.description, "") %>
CLASS <%- model.name %>
    EXTENDS: BaseObject
    NAMESPACE: [Your namespace here, e.g., io.newgrounds.models.objects]
    
    PURPOSE: <%- model.description %>
    
    COMMENT: ====================================================================================
    COMMENT: PRIVATE PROPERTIES
    COMMENT: ====================================================================================
    
<% if (hasProperties) { -%>
<%   for (let propertyName in model.properties) { -%>
<%     if (model.properties[propertyName].required) requiredParams.push(propertyName); -%>
    COMMENT: <%- model.properties[propertyName].description %>
    PRIVATE <%- propertyName %>: <%- helpers.getDataType(model.properties[propertyName]) %> = <%- model.properties[propertyName].default === undefined ? "null" : JSON.stringify(model.properties[propertyName].default) %>
    
<%   } -%>
<% } -%>
    COMMENT: ====================================================================================
    COMMENT: PUBLIC PROPERTIES
    COMMENT: ====================================================================================
    
    PUBLIC objectName: string = "<%- model.name %>"
        PURPOSE: Identifies this object type for debugging and type checking
    
    PUBLIC requiredParams: array<string> = <%- JSON.stringify(requiredParams) %>
        PURPOSE: Lists which properties must be provided when creating this object
        WHY: Used for validation - the API requires certain properties to function correctly
    
<%- partial.getIfExists(`objects/${model.name}/properties`) -%>

    COMMENT: ====================================================================================
    COMMENT: CONSTRUCTOR
    COMMENT: ====================================================================================
    
    CONSTRUCTOR(initialData: object)
        
        PURPOSE: Initialize this object with data from the API or user input.
        
        PARAMETERS:
            initialData: An object containing initial property values
        
        BEHAVIOR:
            COMMENT: Call the parent BaseObject constructor
            CALL super()
            
            COMMENT: Set all properties from the initialData object
            FOR EACH property IN initialData
                IF property exists in this.propertyNames THEN
                    COMMENT: Use the setter to apply the value (handles type conversion, validation)
                    SET this[property] TO initialData[property]
                ELSE
                    COMMENT: Invalid property provided
                    THROW Error("Property '" + property + "' is not defined for object '" + this.objectName + "'")
                END IF
            END FOR
    END CONSTRUCTOR
    
    COMMENT: ====================================================================================
    COMMENT: GETTERS AND SETTERS
    COMMENT: ====================================================================================
    
<% if (hasProperties) { -%>
<%   for (let propertyName in model.properties) { -%>
    <%- helpers.formatMultilineComment(model.properties[propertyName].description, "    ", false) %>
    GETTER <%- propertyName %>(): <%- helpers.getDataType(model.properties[propertyName]) %>
        PURPOSE: Returns the current value of <%- propertyName %>
        RETURN this._<%- propertyName %>
    END GETTER
    
    SETTER <%- propertyName %>(value: <%- helpers.getDataType(model.properties[propertyName]) %>)
        PURPOSE: Sets the value of <%- propertyName %>
        
        COMMENT: Add type conversion/validation logic here as needed
        COMMENT: Property type: <%- model.properties[propertyName].type || 'N/A' %>
<%     if (model.properties[propertyName].object) { -%>
        COMMENT: This property is an object type: <%- model.properties[propertyName].object %>
<%     } -%>
<%     if (model.properties[propertyName].array) { -%>
        COMMENT: This property can be an array
<%     } -%>
        
        SET this._<%- propertyName %> TO value
    END SETTER
    
<%   } -%>
<% } -%>
    COMMENT: ====================================================================================
    COMMENT: CUSTOM METHODS
    COMMENT: ====================================================================================
<%# Add object-specific methods using partials -%>
<%# Example: {partials_dir}/objects/Medal/methods.ejs -%>
<%- partial.getIfExists(`objects/${model.name}/methods`) -%>

END CLASS
