<%
/**
 * ====================================================================================
 * TEMPLATE: Component Model
 * ====================================================================================
 * 
 * PURPOSE: Generates class files for Newgrounds.io component methods.
 * 
 * WHAT ARE COMPONENTS?: Components are API methods you can call, organized by category:
 * - App.checkSession: Validates the current user session
 * - Medal.unlock: Unlocks an achievement for the user
 * - ScoreBoard.postScore: Posts a score to a leaderboard
 * - CloudSave.loadSlot: Loads saved game data from the cloud
 * 
 * AVAILABLE VARIABLES:
 * - model: Object containing all properties and metadata for this component method
 * - model.component: The component namespace (e.g., "Medal", "App", "ScoreBoard")
 * - model.method: The method name (e.g., "unlock", "checkSession", "postScore")
 * - model.description: Human-readable description of what this method does
 * - model.properties: Object containing all parameters this method accepts
 * - model.secure: Boolean - if true, this must be encrypted to prevent cheating
 * - model.require_session: Boolean - if true, requires a logged-in user
 * - model.redirect: Boolean - if true, opens in new tab and redirects
 * - helpers: Your custom helper methods (from helpers.js)
 * - partial: Methods to include partial templates (partial.get, partial.getIfExists)
 * - config: Your full config object with all settings
 * 
 * EJS DOCUMENTATION: https://ejs.co/
 * 
 * ====================================================================================
 */

// COMMENT: Prepare data structures we'll need while generating this class
const propertyNames = model.properties ? Object.keys(model.properties) : [];
const requiredParams = [];
const hasProperties = propertyNames.length > 0;
-%>

COMMENT: ====================================================================================
COMMENT: IMPORTS / DEPENDENCIES
COMMENT: ====================================================================================
<%# Include any imports needed for this component. -%>
<%# Use partials to add component-specific imports. Example partial path for Medal.unlock: -%>
<%# {partials_dir}/components/Medal/unlock/imports.ejs -%>
<%- partial.getIfExists(`components/${model.component}/${model.method}/imports`) -%>

COMMENT: ====================================================================================
COMMENT: CLASS DEFINITION
COMMENT: ====================================================================================
<%- helpers.formatMultilineComment(`Used to call the ${model.component}.${model.method} component.\n${model.description}`, "") %>
CLASS <%- model.method %>
    EXTENDS: BaseComponent
    NAMESPACE: [Your namespace here, e.g., newgroundsIO.models.components.<%- model.component %>]
    
    PURPOSE: <%- model.description %>
    
    COMPONENT INFO:
        Component: <%- model.component %>
        Method: <%- model.method %>
        Secure: <%- model.secure ? 'Yes (must be encrypted)' : 'No' %>
        Requires Session: <%- model.require_session ? 'Yes (user must be logged in)' : 'No' %>
        Is Redirect: <%- model.redirect ? 'Yes (opens in new tab)' : 'No' %>
    
    COMMENT: ====================================================================================
    COMMENT: PRIVATE PROPERTIES
    COMMENT: ====================================================================================
    
<% if (hasProperties) { -%>
<%   for (let propertyName in model.properties) { -%>
<%     if (model.properties[propertyName].required) requiredParams.push(propertyName); -%>
    COMMENT: <%- model.properties[propertyName].description %>
    PRIVATE <%- propertyName %>: <%- helpers.getDataType(model.properties[propertyName]) %> = <%- model.properties[propertyName].default === undefined ? "null" : JSON.stringify(model.properties[propertyName].default) %>
    
<%   } -%>
<% } -%>
    COMMENT: ====================================================================================
    COMMENT: PUBLIC PROPERTIES
    COMMENT: ====================================================================================
    
    PUBLIC componentName: string = "<%- model.component %>.<%- model.method %>"
        PURPOSE: Identifies this component for debugging and API calls
        WHY: The server needs to know which component method to execute
    
    PUBLIC propertyNames: array<string> = <%- JSON.stringify(propertyNames) %>
        PURPOSE: Lists all parameter names this component accepts
    
    PUBLIC requiredParams: array<string> = <%- JSON.stringify(requiredParams) %>
        PURPOSE: Lists which parameters must be provided when calling this component
        WHY: Used for validation - the API requires certain parameters to function correctly
    
    PUBLIC isSecure: boolean = <%= model.secure ? "true" : "false" %>
        PURPOSE: Indicates if this component must be encrypted before sending
        WHY: Prevents cheating - secure components (like medal unlocks) must be encrypted
             so users can't fake API calls in the browser console
    
    PUBLIC requireSession: boolean = <%= model.require_session ? "true" : "false" %>
        PURPOSE: Indicates if this component requires a logged-in user
        WHY: Some actions (like unlocking medals) only work when a user is logged in
    
    PUBLIC isRedirect: boolean = <%= model.redirect ? "true" : "false" %>
        PURPOSE: Indicates if this component should open in a new browser tab
        WHY: Some components (like loading external URLs) redirect the user to another page
    
<%- partial.getIfExists(`components/${model.component}/${model.method}/properties`) -%>

    COMMENT: ====================================================================================
    COMMENT: CONSTRUCTOR
    COMMENT: ====================================================================================
    
    CONSTRUCTOR(<% if (hasProperties) { %>parameters: object<% } %>)
        
        PURPOSE: Initialize this component with parameters for the API call.
        
<% if (hasProperties) { -%>
        PARAMETERS:
            parameters: An object containing parameter values
        
<% } -%>
        BEHAVIOR:
            COMMENT: Call the parent BaseComponent constructor
            CALL super()
            
<%- partial.getIfExists(`components/${model.component}/${model.method}/constructor`) -%>
<% if (hasProperties) { -%>
            
            COMMENT: Set all parameters from the parameters object
            FOR EACH parameter IN parameters
                IF parameter exists in this.propertyNames THEN
                    COMMENT: Use the setter to apply the value (handles type conversion, validation)
                    SET this[parameter] TO parameters[parameter]
                ELSE
                    COMMENT: Invalid parameter provided
                    THROW Error("Property '" + parameter + "' is not defined for component '" + this.componentName + "'")
                END IF
            END FOR
<% } -%>
    END CONSTRUCTOR
    
    COMMENT: ====================================================================================
    COMMENT: GETTERS AND SETTERS
    COMMENT: ====================================================================================
    
<% if (hasProperties) { -%>
<%   for (let propertyName in model.properties) { -%>
    <%- helpers.formatMultilineComment(model.properties[propertyName].description, "    ", false) %>
    GETTER <%- propertyName %>(): <%- helpers.getDataType(model.properties[propertyName]) %>
        PURPOSE: Returns the current value of <%- propertyName %>
        RETURN this._<%- propertyName %>
    END GETTER
    
    SETTER <%- propertyName %>(value: <%- helpers.getDataType(model.properties[propertyName]) %>)
        PURPOSE: Sets the value of <%- propertyName %>
        
        COMMENT: Add type conversion/validation logic here as needed
        COMMENT: Property type: <%- model.properties[propertyName].type || 'N/A' %>
<%     if (model.properties[propertyName].object) { -%>
        COMMENT: This property is an object type: <%- model.properties[propertyName].object %>
<%     } -%>
<%     if (model.properties[propertyName].array) { -%>
        COMMENT: This property can be an array
<%     } -%>
        
        SET this._<%- propertyName %> TO value
    END SETTER
    
<%   } -%>
<% } -%>
    COMMENT: ====================================================================================
    COMMENT: CUSTOM METHODS
    COMMENT: ====================================================================================
<%# Add component-specific methods using partials -%>
<%# Example: {partials_dir}/components/Medal/unlock/methods.ejs -%>
<%- partial.getIfExists(`components/${model.component}/${model.method}/methods`) -%>

END CLASS