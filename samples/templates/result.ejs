<%
/**
 * ====================================================================================
 * TEMPLATE: Component Result Model
 * ====================================================================================
 * 
 * PURPOSE: Generates class files for component result objects.
 * 
 * WHAT ARE RESULTS?: When you call a component (API method), the server responds with
 * a result object containing the data returned. For example:
 * - Medal.unlock returns: { medal_score: number, unlocked_medals: array<Medal> }
 * - ScoreBoard.getScores returns: { scores: array<Score>, user: User }
 * - App.checkSession returns: { session: Session }
 * 
 * WHY SEPARATE FROM COMPONENTS?: Components are what you SEND to the server (input),
 * Results are what you GET BACK from the server (output). They're modeled separately.
 * 
 * AVAILABLE VARIABLES:
 * - model: Object containing all properties and metadata for this result
 * - model.component: The component namespace (e.g., "Medal", "App", "ScoreBoard")
 * - model.method: The method name (e.g., "unlock", "checkSession", "getScores")
 * - model.properties: Object containing all properties this result returns
 * - helpers: Your custom helper methods (from helpers.js)
 * - partial: Methods to include partial templates (partial.get, partial.getIfExists)
 * - config: Your full config object with all settings
 * 
 * EJS DOCUMENTATION: https://ejs.co/
 * 
 * ====================================================================================
 */

// COMMENT: Prepare data structures we'll need while generating this class
// NOTE: Filter out 'error' because it's inherited from BaseObject
const propertyNames = Object.keys(model.properties).filter(prop => prop !== 'error');
const requiredParams = [];
const hasProperties = propertyNames.length > 0;
-%>

COMMENT: ====================================================================================
COMMENT: IMPORTS / DEPENDENCIES
COMMENT: ====================================================================================
<%# Include any imports needed for this result type. -%>
<%# Use partials to add result-specific imports. Example partial path for Medal.unlock: -%>
<%# {partials_dir}/results/Medal/unlock/imports.ejs -%>
<%- partial.getIfExists(`results/${model.component}/${model.method}/imports`) -%>

COMMENT: ====================================================================================
COMMENT: CLASS DEFINITION
COMMENT: ====================================================================================
COMMENT: Returned when the <%- model.component %>.<%- model.method %> component is called.
CLASS <%- model.method %>Result
    EXTENDS: BaseResult
    NAMESPACE: [Your namespace here, e.g., io.newgrounds.models.results.<%- model.component %>]
    
    PURPOSE: Contains the data returned by the <%- model.component %>.<%- model.method %> API call.
    
    RESULT INFO:
        Component: <%- model.component %>
        Method: <%- model.method %>
    
    COMMENT: ====================================================================================
    COMMENT: PRIVATE PROPERTIES
    COMMENT: ====================================================================================
    
<% if (hasProperties) { -%>
<%   for (let propertyName in model.properties) { -%>
<%     if (model.properties[propertyName].required) requiredParams.push(propertyName); -%>
    COMMENT: <%- model.properties[propertyName].description %>
    PRIVATE <%- propertyName %>: <%- helpers.getDataType(model.properties[propertyName]) %> = <%- model.properties[propertyName].default === undefined ? "null" : JSON.stringify(model.properties[propertyName].default) %>
    
<%   } -%>
<% } -%>
    COMMENT: ====================================================================================
    COMMENT: PUBLIC PROPERTIES
    COMMENT: ====================================================================================
    
    PUBLIC componentName: string = "<%- model.component %>.<%- model.method %>"
        PURPOSE: Identifies which component method returned this result
        WHY: Useful for debugging - knowing which API call produced this data
    
    PUBLIC propertyNames: array<string> = <%- JSON.stringify(propertyNames) %>
        PURPOSE: Lists all property names this result contains
    
    PUBLIC requiredParams: array<string> = <%- JSON.stringify(requiredParams) %>
        PURPOSE: Lists which properties should always be present in a valid result
        WHY: Used for validation - ensures the server returned all expected data
    
<%- partial.getIfExists(`results/${model.component}/${model.method}/properties`) -%>

    COMMENT: ====================================================================================
    COMMENT: CONSTRUCTOR
    COMMENT: ====================================================================================
    
    CONSTRUCTOR(resultData: object)
        
        PURPOSE: Initialize this result object with data returned from the server.
        
        PARAMETERS:
            resultData: An object containing the result data from the API response
        
        BEHAVIOR:
            COMMENT: Call the parent BaseResult constructor
            CALL super()
            
<%- partial.getIfExists(`results/${model.component}/${model.method}/constructor`) -%>
            
            COMMENT: Set all properties from the resultData object
            FOR EACH property IN resultData
                IF property exists in this.propertyNames THEN
                    COMMENT: Use the setter to apply the value (handles type conversion, validation)
                    SET this[property] TO resultData[property]
                ELSE
                    COMMENT: Unexpected property in server response
                    THROW Error("Property '" + property + "' is not defined for result '" + this.componentName + "'")
                END IF
            END FOR
    END CONSTRUCTOR
    
    COMMENT: ====================================================================================
    COMMENT: GETTERS AND SETTERS
    COMMENT: ====================================================================================
    
<% if (hasProperties) { -%>
<%   for (let propertyName in model.properties) { -%>
    <%- helpers.formatMultilineComment(model.properties[propertyName].description, "    ", false) %>
    GETTER <%- propertyName %>(): <%- helpers.getDataType(model.properties[propertyName]) %>
        PURPOSE: Returns the current value of <%- propertyName %>
        RETURN this._<%- propertyName %>
    END GETTER
    
    SETTER <%- propertyName %>(value: <%- helpers.getDataType(model.properties[propertyName]) %>)
        PURPOSE: Sets the value of <%- propertyName %>
        
        COMMENT: Add type conversion/validation logic here as needed
        COMMENT: Property type: <%- model.properties[propertyName].type || 'N/A' %>
<%     if (model.properties[propertyName].object) { -%>
        COMMENT: This property is an object type: <%- model.properties[propertyName].object %>
<%     } -%>
<%     if (model.properties[propertyName].array) { -%>
        COMMENT: This property can be an array
<%     } -%>
        
        SET this._<%- propertyName %> TO value
    END SETTER
    
<%   } -%>
<% } -%>
    COMMENT: ====================================================================================
    COMMENT: CUSTOM METHODS
    COMMENT: ====================================================================================
<%# Add result-specific methods using partials -%>
<%# Example: {partials_dir}/results/Medal/unlock/methods.ejs -%>
<%- partial.getIfExists(`results/${model.component}/${model.method}/methods`) -%>

END CLASS